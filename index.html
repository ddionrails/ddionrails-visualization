<!DOCTYPE html>
<html>
    <head>
        <title>Visualization</title>
		
		<!-- D3.js -->
		<script src='http://d3js.org/d3.v2.js'></script>   
		
		<script src='./chart.js'></script>
		<script src='./cat_uni.js'></script>
		<script src='./testdata/edu.json'></script>
		<link rel='stylesheet' href='./style.css' />
                
    </head>
	
    <body>
	
		<div id='menu'></div>
		<div id='chart'></div>
		

		<script>
			
			// Menu
			const h = 40;
			const menu2_data = ['age', 'sex', 'sample', 'wave'];
			const menu3_data = ['percent', 'missings', 'weights'];
		
			var options = {
				'missings': 	false,
				'percent':		false,
				'weights':		false,
			}
			var menu2_active = 'none';
			var menu3_active;
			var circle_filled = false;
			
			cat_uni(options);
			
			function svg(w, h){
				var svg = d3.select('#menu')
							.append('svg')
							.attr('width', w)
							.attr('height', h);
				return svg;
			}
			
			function scale(domain, rangeMin, rangeMax){
				var scale = d3.scale.ordinal()
								.domain(domain)
								.rangeBands([rangeMin, rangeMax]);
				return scale;
			}
			
			const menu1_svg = svg(100, h);
			const menu2_svg = svg(250, h);
			const menu3_svg = svg(250, h);
					
			const menu2_scale = scale(menu2_data, 10, 250);
			const menu3_scale = scale(menu3_data, 65, 250);			
									
	
			menu1_svg.append('text')
						.text(rawData.variable)
						.attr('x', 90)
						.attr('y', h / 2)
						.attr('class', 'menu1_text')
						.on('click', function(){
							
							d3.selectAll('.menu2_circles').attr('fill', 'white').attr('stroke', 'steelblue');
							d3.selectAll('.menu_rects').attr('fill', 'white').attr('stroke', 'grey');
							options = {
								'missings': 	false,
								'percent':		false,
								'weights':		false,
							}	
							cat_uni(options);
							menu2_active = 'none';
						});
		
			const menu2 = menu2_svg.selectAll('g')
							.data(menu2_data)
							.enter()
							.append('g');
							
			menu2.append('circle')
					.attr('cx', function(d, i){return menu2_scale(i)})
					.attr('cy', 16)
					.attr('r', 5)
					.attr("fill", "white")
					.attr("stroke", "grey")
					.attr("stroke-width", 1)
					.attr('class', 'menu2_circles');
					
			menu2.append('text')
					.attr('x', function(d, i){return menu2_scale(i) + 10})
					.attr('y', h / 2)
					.text(function(d){ return d; })
					.attr('class', 'menu2_text');					
							
							
			menu2.on('click', function(d){
				menu2_active = d;
				
				try {
					organizeData(options, menu2_active);
					drawChart();
				}
				catch(error) {
					d3.select('.chart').remove();
					d3.select('#chart').append('p').text('Not available.').attr('class', 'chart');
				};
				
				console.log(circle_filled)
				if(circle_filled == false) {
					d3.selectAll('circle').attr('fill', 'white').attr('stroke', 'grey')
					d3.select(this).select('circle').attr('fill', 'steelblue').attr('stroke', 'steelblue')
					circle_filled = true;
				}
				else {
					d3.selectAll('circle').attr('fill', 'white').attr('stroke', 'grey')
					d3.select(this).select('circle').attr('fill', 'steelblue').attr('stroke', 'steelblue')
					circle_filled = false;
				};	
			});	
			
			const menu3 = menu3_svg.selectAll('g')
							.data(menu3_data)
							.enter()
							.append('g');
		
			menu3.append('rect')
					.attr('x', function(d, i){return menu3_scale(i)})
					.attr('y', 12)
					.attr('height', 9)
					.attr('width', 9)
					.attr("fill", "white")
					.attr("stroke", "steelblue")
					.attr("stroke-width", 1)
					.attr('class', 'menu3_rects');	

			menu3.append('text')
					.attr('x', function(d, i){return menu3_scale(i) + 14})
					.attr('y', h / 2)
					.text(function(d){ return d})
					.attr('text-anchor', 'left')
					.attr('font-weight', '')
					.attr('fill', 'grey')
					.attr('font-family', 'sans-serif')
					.attr('font-size', '11px');
					
			menu3.on('click', function(d){
								
				if(options[d] == false){
					options[d] = true;
					if(menu2_active == 'none' ){
						cat_uni(options);
					}
					else{
						organizeData(options, menu2_active);
						drawChart();
					}
					d3.select(this).select('rect').attr('fill', 'steelblue')	
				}
				else{
					options[d] = false;
					if(menu2_active == 'none' ){
						cat_uni(options);
					}
					else{
						organizeData(options, menu2_active);
						drawChart();
					}
					d3.select(this).select('rect').attr('fill', 'white')
				}
			});		
			
		</script>
		</body>
</html>